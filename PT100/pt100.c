/*
*********************************************************************************************************
* HeadFile
*********************************************************************************************************
*/

#include "pt100.h"

/*
*********************************************************************************************************
* 功  能：温度转电阻
* 形  参：温度值
* 返回值：电阻值
* 备  注：PT100
* 作  者：LG
* 日  期：2020/12/22
*********************************************************************************************************
*/

float Pt100_TtoR(float t)
{
    float r = 0;
    
    if(t>=-200 && t<0)
    {
        r = 100 * (1 + A*t + B*t*t + C*(t-100)*t*t*t);
    }
    else if(t>=0 && t<=850)
    {
        r = 100 * (1 + A*t + B*t*t);
    }
    else
        r = 390.481;
    
    return r;
}

/*
*********************************************************************************************************
* 功  能：电阻转温度
* 形  参：电阻值
* 返回值：温度值
* 备  注：PT100
* 作  者：LG
* 日  期：2020/12/22
*********************************************************************************************************
*/

float Pt100_RtoT(float r)
{
	float t = 0, r0 = 0;
    uint8_t i = 0;
    
    r0 = (r/100-1)/A;
    
	if(r>=18.52 && r<100)
	{
		for(i=0; i<50; i++)
		{
			t = r0 + (r - 100*(1 + A*r0+B*r0*r0 - 100*C*r0*r0*r0 + C*r0*r0*r0*r0)) / (100*(A + 2*B*r0 - 300*C*r0*r0 + 4*C*r0*r0*r0));
			if(fabs(t-r0)<0.001)
				break;
			else
				r0 = t;
		}
    }
    else if(r>=100 && r<=390.481)
    {
        for(i=0; i<50; i++)
        {
            t = r0 + (r - 100*(1 + A*r0+B*r0*r0)) / (100*(A + 2*B*r0));
            if(fabs(t-r0)<0.001)
                break;
            else
                r0=t;
        }
    }
    else
        t = 0;
    
    return t;
}
