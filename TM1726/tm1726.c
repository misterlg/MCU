/*
*********************************************************************************************************
* HeadFile
*********************************************************************************************************
*/

#include "tm1726.h"

/*
*********************************************************************************************************
* 功  能：延时微妙
* 形  参：几微秒
* 返回值：None
* 备  注：None
* 作  者：LG
* 日  期：2020/11/23
*********************************************************************************************************
*/

static void Delay_Us(uint8_t us)
{
	while(--us);
}

/*
*********************************************************************************************************
* 功  能：Tm1726引脚初始化
* 形  参：None
* 返回值：None
* 备  注：SCK - XX 推挽输出
*         SDA - XX 开漏输出
* 作  者：LG
* 日  期：2020/11/23
*********************************************************************************************************
*/

static void Tm1726_Pin_Init(void)
{
    XX    
}

/*
*********************************************************************************************************
* 功  能：Tm1726起始信号
* 形  参：None
* 返回值：None
* 备  注：None
* 作  者：LG
* 日  期：2020/11/23
*********************************************************************************************************
*/

static void Tm1726_Start(void)
{
    SCK_W_1;
    SDA_W_1;    
    Delay_Us(0x10);
    SDA_W_0;
    Delay_Us(0x10);
    SCK_W_0;
}

/*
*********************************************************************************************************
* 功  能：TM1726停止信号
* 形  参：None
* 返回值：None
* 备  注：None
* 作  者：LG
* 日  期：2020/11/23
*********************************************************************************************************
*/

static void Tm1726_Stop(void)
{
    SDA_W_0;
    SCK_W_1;    
    Delay_Us(0x10);
    SDA_W_1;
    Delay_Us(0x10);
}

/*
*********************************************************************************************************
* 功  能：主机读取从机发送的应答信号
* 形  参：None
* 返回值：0: 应答
*         1: 非应答
* 备  注：None
* 作  者：LG
* 日  期：2020/11/23
*********************************************************************************************************
*/

static uint8_t Tm1726_Get_Ack(void)
{
    uint8_t ack = 0;
    
    SCK_W_0;                                                                     /* 从机准备数据       */
    SDA_W_1;                                                                     /* 读模式             */
    Delay_Us(0x10);
    SCK_W_1;                                                                     /* 主机采集数据       */
    if(SDA_R)
        ack = 1;
    else
        ack = 0;
    SCK_W_0;
    
    return ack;
}

/*
*********************************************************************************************************
* 功  能：主机发送一帧数据
* 形  参：待发送的数据
* 返回值：0: 应答
*         1: 非应答
* 备  注：None
* 作  者：LG
* 日  期：2020/11/23
*********************************************************************************************************
*/

static uint8_t Tm1726_Write_Data(uint8_t data)
{
    uint8_t i = 0;
    
    for(i=0; i<8; i++)
    {
        SCK_W_0;                                                                 /* 主机准备数据       */
        if(data & 0x01)
            SDA_W_1;
        else
            SDA_W_0;
        Delay_Us(0x10);                                                          /* 保持数据稳定       */
        CLK_W_1;                                                                 /* 从机采集数据       */
        Delay_Us(0x10);
        data >>= 1;
    }
    CLK_W_0;                                                                     /* 为下一步操作做准备 */
    
    return Tm1726_Get_Ack();
}

/*
*********************************************************************************************************
* 功  能：LCD清屏
* 形  参：None
* 返回值：None
* 备  注：None
* 作  者：LG
* 日  期：2020/11/23
*********************************************************************************************************
*/

void Lcd_Clear(uint8_t data)
{
    uint8_t i = 0;
    
    Tm1726_Start();
    while(!Tm1726_Write_Data(0xc0));
    for(i=0; i<18; i++)
    {
        while(!Tm1726_Write_Data(data));
    }
    Tm1726_Stop();
}

/*
*********************************************************************************************************
* 功  能：LCD初始化
* 形  参：None
* 返回值：None
* 备  注：None
* 作  者：LG
* 日  期：2020/11/23
*********************************************************************************************************
*/

void Lcd_Init(void)
{
    Tm1726_Pin_Init();
    Tm1726_Start();
    while(!Tm1726_Write_Data(0x2f));
    Tm1726_Stop();
    Lcd_Clear(0x00);
}

/*
*********************************************************************************************************
* 功  能：LCD指定地址写数据
* 形  参：address - 地址
*         data    - 数据 
* 返回值：None
* 备  注：None
* 作  者：LG
* 日  期：2020/11/23
*********************************************************************************************************
*/

void Lcd_Write_Address(uint8_t address, uint8_t data)
{
    Tm1726_Start();
    while(!Tm1726_Write_Data(0xc0+address));
    while(!Tm1726_Write_Data(data));
    Tm1726_Stop();
    
    Tm1726_Start();
    while(!Tm1726_Write_Data(0x27));
    Tm1726_Stop();
}




